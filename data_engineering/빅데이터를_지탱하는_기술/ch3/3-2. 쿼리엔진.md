hadoop에 의하여 비구조화 데이터나 스키마리스 데이터들을 구조화 데이터로 변형하여 비정규화 테이블에 저장되는 파이프라인에는 대표적으로 hive와 presto가 사용된다.

> MapReduce는 말 그대로 HDFS에 저장된 데이터를 집계하거나 처리하기 위함이고, 저장된 데이터를 구조화하기 위해서는 쿼리엔진을 활용한다고 이해했다.

# 데이터 마트 구축의 파이프라인
처음 분산 스토리지에 저장된 데이터를 구조화하고 열 지향 스토리지 형식으로 저장하는 것은 다수의 텍스트 파일을 읽어 사용하므로 hive를 사용한다.
그리고 완성된 구조화 데이터를 결합하고 집계햐여 비정규화 테이블로 만드는 과정은 presto를 활용하여 시간을 단축한다.

# Hive에 의한 구조화 데이터 작성
Hive로 구조화 데이터를 작성할 때는 외부 특정 파일에 테이블이 존재하는 것 처럼 읽어들인다.
이런 식으로 데이터베이스처럼 데이터를 내부로 가지고 오지 않아도 텍스트 파일을 그대로 집계할 수 있다.

즉 데이터를 그 자리에서 바로 집계할 수 있는 것이다. 그러나 이는 비효율적이다. 
쿼리를 실행할 때 마다 텍스트를 읽어들어야 하기 때문에 매우 느리다.

따라서 Hive로 열 지향 스토리지 형식을 만들고, 외부 테이블에서 읽은 데이터를 모두 저장한다.
이를 통해 변환에서의 시간은 소요될지 몰라도 이후 집계 과정에서의 시간을 절약할 수 있다.

이후 비정규화 테이블을 만들 때 presto 같은 대화형 쿼리엔진을 사용할 것인지, Hive 같은 배치형 쿼리엔진을 사용할 것인지에 따라 활용 방법이 달라진다.

기본적으로 위에서도 언급했지만, 데이터의 양이 많아서 시간이 걸리는 작업은 Hive로 한다.
만약 Hive를 사용한다면 효율적인 쿼리를 작성해야하며, 이를 위한 방법으로는 두 가지가 있다.

## 1. 서브쿼리 안에서 레코드 수 줄이기
Hive는 기본적으로 SQL과 유사하나, 일반적인 특성에서 차이가 난다. 
데이터 처리를 위한 배치 처리 구조이므로, 읽어들이는 데이터 양을 의식하면서 쿼리를 작성해야 한다.
(가령 join을 할 때 테이블들에 where 조건을 걸지 않고 join하면 중간 데이터가 불필요하게 생성된다.)

즉, 두 테이블을 결합할 때 결합되는 중간 테이블 자체에도 필터링을 걸어주어야 중간 데이터가 최대한 줄어든다.

## 2. 데이터 편향 피하기(분산 시스템의 성능 발휘를 위해)

# 대화형 쿼리엔진 Presto의 구조
Hive가 대량출력을 수반하는 대규모 데이터 처리에 적합하다면, 작은 쿼리를 여러 번 실행하는 대화형 데이터 처리에는 presto가 적합하다.

presto는 플러그인이 가능한 스토리지 설계가 가능하다. 즉 하나의 쿼리 안에서 여러 데이터 소스에 연결 가능하다.
presto는 보통 Hive 메타스토어에 등록된 테이블을 가져올 수 있으므로 hive에서 만든 구조화 데이터를 집계하는 목적에 적합하다.

물론 다른 데이터 소스도 참고할 수 있지만, Hive보다 성능이 훨씬 떨어지므로 
presto를 효율적으로 활용하려면 참고하는 데이터 스토리지가 열 지향 데이터 구조로 되어있어야 한다.

presto는 읽기와 코드 실행을 병렬 처리한다. 디스크에 쓰기 작업을 하지 않고 메모리만을 사용한다.
또한 presto는 기본적으로 분산 결합을 실시하여 같은 키를 갖는 데이터는 동일한 노드에 모인다.

# 데이터 분석의 프레임워크 선택하기(MPP 데이터베이스, Hive, Presto, Spark)
실제로 현재 처리해야하는 데이터의 양이나 상황에 따라서 클라우드 서비스로 시작할 수도 있고
서버를 설치해서 엔진을 가동할 수도 있다. 즉 상황에 따라서 적절한 프레임워크를 선택해야 한다.

## MPP 데이터베이스
완성한 비정규화 테이블의 고속 집계에 적합하다. 즉 SQL로 집계/조회하는 업무가 대부분일 때 적절하다.
그러나 확장성 및 유연성에는 분산 시스템이 유리하다. 대량의 텍스트 처리나 데이터 처리를 프로그래밍하거나, 
NoSQL 데이터베이스에 저장된 데이터를 집계하고 싶은 경우가 이런 경우이다.

따라서 이미 구조화가 완료된 데이터를 처리하여 비정규화 테이블로 만들어 데이터 마트로 활용하려 할 때 MPP 데이터베이스는 최적이다.

## Hive
데이터 양에 좌우되지 않는 쿼리엔진이다. 안정성이 장점이며, 대규모 배치 처리를 안정적으로 할 때 최적이다.

최근 In-Memory 방식을 많이 활용하지만, 많은 양의 데이터를 안정적으로 다룰 때는 디스크 사용은 어느정도 필요하므로 이 때 Hive를 고려할만하다.

## Presto
속도를 중시하는 대화형 쿼리엔진이다. 모든 데이터를 SQL로 집계하기 위한 중심적인 존재다. 그러나 대화형 쿼리의 실행이 특화되어 있으므로
텍스트 처리 중심의 프로세스와 데이터 구조화에는 적합하지 않다. 즉 ETL 데이터 처리 프로세스는 Hive나 Spark가 적절하다.

## Spark
분산 시스템을 사용한 프로그래밍 환경이다. ETL 프로세스부터 SQL에 이르기까지 일련의 흐름을
하나의 데이터 파이프라인으로 기술할 수 있다는 장점이 있다. Spark에서는 메모리를 어떻게 관리하느냐가 핵심이다.